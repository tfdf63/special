// Утилиты для обработки текста с предотвращением висячих предлогов и союзов

// Список предлогов и союзов, которые не должны оставаться в конце строки
const PREPOSITIONS_AND_CONJUNCTIONS = [
	// Предлоги
	'в',
	'во',
	'на',
	'над',
	'под',
	'за',
	'из',
	'от',
	'до',
	'по',
	'к',
	'у',
	'о',
	'об',
	'со',
	'с',
	'для',
	'про',
	'через',
	'между',
	'среди',
	'вокруг',
	'вдоль',
	'поперёк',
	'внутри',
	'вне',
	'без',
	'против',
	'вместо',
	'вслед',
	'вроде',
	'насчёт',
	'ввиду',
	'вследствие',
	'благодаря',
	'согласно',
	'вопреки',
	'при',
	'около',
	'возле',
	'близ',
	'вдали',
	'впереди',
	'позади',
	'сверху',
	'снизу',
	'спереди',
	'сзади',
	'слева',
	'справа',
	'внутри',
	'снаружи',
	'вверху',
	'внизу',
	'впереди',
	'позади',
	'слева',
	'справа',

	// Союзы
	'и',
	'а',
	'но',
	'или',
	'либо',
	'что',
	'чтобы',
	'если',
	'хотя',
	'пока',
	'когда',
	'где',
	'куда',
	'откуда',
	'как',
	'почему',
	'зачем',
	'сколько',
	'какой',
	'какая',
	'какое',
	'какие',
	'чей',
	'чья',
	'чьё',
	'чьи',
	'не',
	'ни',
	'же',
	'ли',
	'бы',
	'то',
	'либо',
	'ведь',
	'мол',
	'дескать',
	'де',
	'тко',
	'поскольку',
	'так',
	'также',
	'тоже',
	'притом',
	'причём',
	'зато',
	'однако',
	'тем',
	'нежели',
	'словно',
	'точно',
	'будто',
	'как',
	'будто',
	'если',
	'ежели',
	'коль',
	'коль',
	'скоро',
	'раз',
	'хотя',
	'пусть',
	'пускай',
	'допустим',
	'допустим',
	'что',
	'чтобы',
	'дабы',
	'лишь',
	'только',

	// Частицы
	'ли',
	'ль',
	'бы',
	'б',
	'же',
	'ж',
	'ведь',
	'вон',
	'вот',
	'дескать',
	'де',
	'мол',
	'то',
	'либо',
	'не',
	'ни',
	'да',
	'нет',
	'уже',
	'ещё',
	'всего',
	'всегда',
	'никогда',
	'иногда',
	'часто',
	'редко',

	// Местоимения (короткие формы)
	'он',
	'она',
	'оно',
	'они',
	'мы',
	'вы',
	'я',
	'ты',
	'себя',
	'мой',
	'твой',
	'наш',
	'ваш',
	'его',
	'её',
	'их',

	// Наречия (короткие)
	'там',
	'тут',
	'здесь',
	'где',
	'куда',
	'откуда',
	'когда',
	'как',
	'почему',
	'зачем',
	'сколько',
	'очень',
	'слишком',
	'вполне',
	'совсем',
	'почти',
	'едва',
	'чуть',
	'немного',
	'много',
	'мало',
]

// Функция для обработки заголовков
export function processHeading(text: string): string {
	if (!text) return text

	// Разбиваем текст на слова
	const words = text.split(' ')

	// Ищем предлоги и союзы в конце
	for (let i = words.length - 1; i >= 0; i--) {
		const word = words[i].toLowerCase().replace(/[^\а-яё]/g, '') // Убираем пунктуацию

		if (PREPOSITIONS_AND_CONJUNCTIONS.includes(word)) {
			// Если предлог/союз в конце, добавляем неразрывный пробел перед ним
			if (i === words.length - 1) {
				words[i] = `&nbsp;${words[i]}`
			} else {
				// Если предлог/союз не в конце, добавляем неразрывный пробел после него
				words[i] = `${words[i]}&nbsp;`
			}
			break // Обрабатываем только первый найденный предлог/союз с конца
		}
	}

	return words.join(' ')
}

// Функция для обработки обычного текста
export function processText(text: string): string {
	if (!text) return text

	// Разбиваем текст на предложения
	const sentences = text.split(/(?<=[.!?])\s+/)

	return sentences
		.map(sentence => {
			// Разбиваем предложение на слова
			const words = sentence.split(' ')

			// Ищем предлоги и союзы в конце предложения
			for (let i = words.length - 1; i >= 0; i--) {
				const word = words[i].toLowerCase().replace(/[^\а-яё]/g, '') // Убираем пунктуацию

				if (PREPOSITIONS_AND_CONJUNCTIONS.includes(word)) {
					// Если предлог/союз в конце предложения, добавляем неразрывный пробел перед ним
					if (i === words.length - 1) {
						words[i] = `&nbsp;${words[i]}`
					} else {
						// Если предлог/союз не в конце, добавляем неразрывный пробел после него
						words[i] = `${words[i]}&nbsp;`
					}
					break // Обрабатываем только первый найденный предлог/союз с конца
				}
			}

			return words.join(' ')
		})
		.join(' ')
}
